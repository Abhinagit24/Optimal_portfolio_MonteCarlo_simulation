---
title: "Project1 Part2 Applied Statistics"
author: "Abhina Premachandran"
date: "2023-10-14"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Monte Carlo Simulations of DIS and HPQ stocks and building a portfolio and estimating the total return and risk
 This project uses Monte Carlo Simulations to simulate daily returns of an investment portfolio. The chosen stocks for this project are 'DIS' and 'HPQ' stocks. Further an optimal portfolio is suggested based on three scenarios on investing the amount on DIS and HPQ stocks. The total return and risk are calculated.

```{r echo=FALSE}
suppressWarnings(suppressMessages(library(quantmod)))
```

Getting the stock data using `getSymbols`. 

```{r}
getSymbols(c('DIS','HPQ','USO','DVN','LMT'), from = Sys.Date() - 150, to = Sys.Date()) 
```


plotting to see the timeseries of DIS and HPQ stocks for the past 150 days
```{r fig.height=3.5, fig.fullwidth=TRUE}
par(mfrow = c(1,2))
plot(DIS$DIS.Close, main = 'DIS',type = 'l',col = 'blue', lwd = 2)
plot(HPQ$HPQ.Close, main = 'HPQ',type = 'l',col = 'violet', lwd = 2)

```

Defining the stock price matrix for each stocks

```{r}
DIS_Price <- as.matrix(as.numeric(DIS$DIS.Close)) 
HPQ_Price <- as.matrix(as.numeric(HPQ$HPQ.Close)) 
```

```{r}
print(Returns_DIS)
print(DIS$DIS.Close)
```


## computing the daily returns using diff()/lag() of Closing prices

```{r}
DIS$DIS.Returns <- diff(DIS$DIS.Close)/lag(DIS$DIS.Close)
Returns_DIS <- DIS$DIS.Returns
```
```{r}
HPQ$HPQ.Returns <- diff(HPQ$HPQ.Close)/lag(HPQ$HPQ.Close)
Returns_HPQ <- HPQ$HPQ.Returns
#Defining N_days as the length of the time series
N_days <- length(Returns_HPQ)
```
## Plotting the daily returns

```{r}
par(mfrow = c(1, 2))
hist(Returns_DIS,main = 'DIS', xlab = 'Daily Returns', col='blue',breaks = 20, freq=TRUE)
hist(Returns_HPQ,main = 'HPQ', xlab = 'Daily Returns', col='violet',breaks = 20, freq=TRUE)
```
From the histogram of each stock, it is clear that the daily returns of the stocks approximately follows a normal distribution. Therefore rnorm() can be used to simulate future returns.
## Computing the mean and standard deviation from the past stock returns inorder to simulate future returns


I am choosing the returns upto 30 days before as the past data to simulate the rest of the 30 days(future stock) until today
```{r}
#To simulate for 30 days until today

DIS_daily_mean <- mean(Returns_DIS[(N_days-31):N_days])
DIS_daily_std <- sd(Returns_DIS[(N_days-31):N_days])

HPQ_daily_mean <- mean(Returns_HPQ[(N_days-31):N_days])
HPQ_daily_std <- sd(Returns_HPQ[(N_days-31):N_days])
```

# Monte Carlo Simulation for DIS


rnorm() is used to simulate returns and price for 30 days until today for DIS stock.
```{r}
set.seed(101)
DIS_starting_price <- DIS$DIS.Close[[(N_days-30)]]
returns <- 1+rnorm(30,mean=DIS_daily_mean,sd=DIS_daily_std)
no_sims <- 1001
return_list <- matrix(0, nrow=no_sims,ncol=30)
price_list <- matrix(0,nrow=no_sims,ncol=31)
for(i in 1:no_sims){
  return_list[i,]<-rnorm(30,mean=DIS_daily_mean,sd=DIS_daily_std)
  price_list[i,]<-cumprod(c(DIS_starting_price,1+return_list[i,]))
}
total_returns1 <- array(NA,dim=no_sims,dimnames=NULL)
for(i in 1:no_sims){
  total_returns1[i]<-(price_list[i,31]-price_list[i,1])/price_list[i,1]
}
```


## Monte Carlo Simulation for HPQ

```{r}
set.seed(101)
HPQ_starting_price <- HPQ$HPQ.Close[[(N_days-30)]]
returns <- 1+rnorm(30,mean=HPQ_daily_mean,sd=HPQ_daily_std)
no_sims <- 1001
return_list <- matrix(0, nrow=no_sims,ncol=30)
price_list <- matrix(0,nrow=no_sims,ncol=31)
for(i in 1:no_sims){
  return_list[i,]<-rnorm(30,mean=HPQ_daily_mean,sd=HPQ_daily_std)
  price_list[i,]<-cumprod(c(HPQ_starting_price,1+return_list[i,]))
}
total_returns2 <- array(NA,dim=no_sims,dimnames=NULL)
for(i in 1:no_sims){
  total_returns2[i]<-(price_list[i,31]-price_list[i,1])/price_list[i,1]
}

```


## Building a portfolio
 To build a portfolio the return and risks for different values of weights are calculated using the mean and standard deviations from the simulated returns of DIS and HPQ stocks


Calculating the mean and standard deviations of DIS and defining the functions for calculating the total return and total risk
```{r}
mu1 <- mean(total_returns1)
sigma1 <- sd(total_returns1)
mu2 <- mean(total_returns2)
sigma2 <- sd(total_returns2)
ClosePrices <- merge(DIS$DIS.Close,HPQ$HPQ.Close)
rho_12 <- cor(ClosePrices, use = "pairwise.complete.obs")[1,2]

total_return <- function(w){
  return(w*mu1 + (1-w)*mu2)
}
total_risk <- function(w){
  return(w^2*sigma1^2 + (1-w)^2*sigma2^2 + 2*w*(1-w)*rho_12*sigma1*sigma2)
}
```
From the previous computations, the cost of DIS is \$`r round(DIS_starting_price,2)`. Our analysis has shown that their expected return is \$`r round(mu1, digits=4)` per share with a standard deviation of \$`r round(sigma1, digits=4)`. Shares of HPQ cost \$`r round(HPQ_starting_price,2)` per share, with an expected return of \$`r round(mu2, digits=4)` and a standard deviation of \$`r round(sigma2, digits=4)`. We will assume that the returns from the two companies are independent. 

## Using a for loop to find and plot the returns and risks for all weight values
```{r}
# taking all values from -1 to 1 with a step value of 0.01 for weights 
weights <- seq(-1, 1, by = 0.01)

returns <- NULL
risks <- NULL


for(w in weights){
  returns <- c(returns, total_return(w))
  risks <- c(risks, total_risk(w))
}

plot(risks, returns,
     xlab = "Portfolio risk",
     ylab = "Portfolio return",
     main = "Risk-return relationship across weights")


```
## Finding and plotting the minimum risk weight and the corresponding return value
```{r}
min_risk_w <- weights[which(risks == min(risks))]
min_risk_return <- mean(total_return(min_risk_w))

efficient_idx <- which(returns >= min_risk_return)
inefficient_idx <- which(returns < min_risk_return)

plot(risks[efficient_idx], returns[efficient_idx],
     xlab = "Portfolio risk",
     ylab = "Portfolio return",
     main = "The Efficient Frontier",
     ylim = c(-0.2,0.2), xlim = c(0.002, 0.01))

lines(risks[inefficient_idx], returns[inefficient_idx], lty = "dotted")

abline(h = min_risk_return)
text(x = 0.003, y = min_risk_return-0.01, "min variance portfolio")
text(x = 0.006, y = 0.15, "efficient frontier")


```

From the analysis above, the minimum risk occurs at the weight value of `r round(min_risk_w, digits=4)` and the corresponding total return for this weight is \$`r round(min_risk_return, digits=4)`.

## Conclusion
   From the analysis, to get optimal return value, `r round(min_risk_w, digits=4)` of the initial investment have to be invested in the DIS stocks and `r round(1 - min_risk_w, digits=4) ` of the investment have to be invested in the HPQ stock. It is clear that investing in DIS and HPQ stocks is not a good choice, as it yields loss in the investment. This is evident from the negative return value of minimum risk weight. It is suggested to invest in other high return yielding stocks for maximum gain. The above model can be used for any combinations of stocks to find the high return yielding portfolio.

```{r,echo = FALSE}

```